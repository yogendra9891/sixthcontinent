<?php

namespace Utility\UniversalNotificationsBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * NotifictionManagerRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class NotifictionManagerRepository extends EntityRepository
{
    
    /**
     * function for updating the citizen income in the userdiscountposition for the CI for purchaser shop affiliator  
     * @param type $user_id
     * @param type $store_id
     * @param type $amount
     * @return type
     */
    public function updateUserNotificationSetting($user_id, $notification_setting, $notification_rules) {
        $notification_manager_table = $this->getEntityManager()->getClassMetadata('UtilityUniversalNotificationsBundle:NotifictionManager')->getTableName();
        $sql = "INSERT INTO  $notification_manager_table (`user_id`,`user_type`,`notification_type`,`notification_setting`) "
                . "values $notification_setting"
                . "ON DUPLICATE KEY UPDATE notification_setting = @value";
        
        $stmt = $this->getEntityManager()
                ->getConnection()
                ->prepare($sql);
        $stmt->execute();
        $result = $stmt->rowCount();
        //$result = json_encode($result);
        return $result;
    }
}
