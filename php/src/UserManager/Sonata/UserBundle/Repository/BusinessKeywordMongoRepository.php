<?php

namespace UserManager\Sonata\UserBundle\Repository;

use Doctrine\ODM\MongoDB\DocumentRepository;

/**
 * BusinessKeywordMongoRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class BusinessKeywordMongoRepository extends DocumentRepository
{
    /**
    * Get Suggestion Search
    * @param \Symfony\Component\HttpFoundation\Request $request
    * @return string
    */
    public function getBusiessKeyword($categoryId, $text, $limit){
        $results = array();
        //get all groups assigned to user
        $qb = $this->createQueryBuilder();
        $results = $qb->field('category_id')->equals($categoryId)
                ->field('keyword')->equals(new \MongoRegex('/.*' . $text . '.*/i'))
                ->sort('id', 'desc')
                ->getQuery()
                ->execute()
                ->toArray(false);
        
        return $results;
    }
    
    /**
    * Get Suggestion Search
    * @param \Symfony\Component\HttpFoundation\Request $request
    * @return string
    */
    public function getBusiessKeywordByText($text, $limit){
        $results = array();
        //get all groups assigned to user
        $qb = $this->createQueryBuilder();
        $results = $qb
                ->field('keyword')->equals(new \MongoRegex('/.*' . $text . '.*/i'))
                ->sort('keyword', 'ASC')
                ->getQuery()
                ->execute()
                ->toArray(false);
        
        return $results;
    }
}