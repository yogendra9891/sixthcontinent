<?php

namespace UserManager\Sonata\UserBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * UserSkillsRepository 
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class UserSkillsRepository extends EntityRepository
{
    /*
    * Insert user selected category keywords 
    */
    public function createAndSaveSkill($data){
        $user_skills_obj = new UserSkills();
        $em = $this->getEntityManager();
        if(!empty($data['userId'])){
            //get user skills object
            $user_skills = $this->findBy(array('userId' => $data['userId']));
        }
        // Save and Update Data
        if(!empty($user_skills)){
            $sql = "UPDATE UserSkills set skills= '".$data['skills']."' WHERE user_id = " .$data['userId'];
            $stmt = $this->getEntityManager()
                          ->getConnection()
                          ->prepare($sql);
            $stmt->execute();
        } else {
            // Set data to update
            $user_skills_obj->setUserId($data['userId']);
            $user_skills_obj->setSkills($data['skills']);
            $em->persist($user_skills_obj);
            $em->flush();
        }
        // Check error 
        if (mysql_error()){
            return FALSE;
        } else {

            $returnArr['skills']['user_id']  = $data['userId'];
            $returnArr['skills']['skills']   = $data['skills'];

            return $returnArr;
        }
    }
}
