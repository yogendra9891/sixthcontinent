<?php

namespace Acme\DemoBundle\Repository;

use Doctrine\ODM\MongoDB\DocumentRepository;

/**
 * UserMediaMongoRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class UserMediaMongoRepository extends DocumentRepository
{

	 /**
	 * Search media 
	 * @param string $text
	 * @param int $user_id
	 * @param int $offset
	 * @param int $limit
	 * @return object array
	 */
	 
	public function searchByMediaNameOrOther($text, $user_id, $offset, $limit)
	{
		$qb     = $this->createQueryBuilder('m');
		$result = $qb->field('userid')->equals($user_id)
		             ->field('name')->equals(new \MongoRegex('/.*'.$text.'.*/i'))
		             ->limit($limit)
		             ->skip($offset)
				     ->getQuery()
				     ->execute()
					 ->toArray(false);
		return $result;
	}
	/**
	 * Search notification messages count
	 * @param string $text
	 * @param int $user_id
	 * @return object array
	 */
	public function searchByMediaNameOrOtherCount($text, $user_id)
	{
		$qb     = $this->createQueryBuilder('m');
		$result = $qb->field('userid')->equals($user_id)
					 ->field('name')->equals(new \MongoRegex('/.*'.$text.'.*/i'))
					 ->hydrate(false)
					 ->getQuery()
					 ->execute()
					 ->toArray(false);
		return count($result);
	}
}